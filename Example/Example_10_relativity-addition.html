<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 10: Relativitistic Velocity Addition &mdash; Kolmogorov Arnold Network  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example 11: Encouraging linearity" href="Example_11_encouraing_linear.html" />
    <link rel="prev" title="Example 9: Singularity" href="Example_9_singularity.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Kolmogorov Arnold Network
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Hello, KAN!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos.html">API Demos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Example_1_function_fitting.html">Example 1: Function Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_3_deep_formula.html">Example 3: Deep Formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_4_classfication.html">Example 4: Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_5_special_functions.html">Example 5: Special functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_6_PDE_interpretation.html">Example 6: Solving Partial Differential Equation (PDE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_7_PDE_accuracy.html">Example 7: Solving Partial Differential Equation (PDE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_8_continual_learning.html">Example 8: Continual Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_9_singularity.html">Example 9: Singularity</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example 10: Relativitistic Velocity Addition</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_11_encouraing_linear.html">Example 11: Encouraging linearity</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_12_unsupervised_learning.html">Example 12: Unsupervised learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_13_phase_transition.html">Example 13: Phase transition</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_14_knot_supervised.html">Example 14: Knot supervised</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_15_knot_unsupervised.html">Example 15: Knot unsupervised</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kolmogorov Arnold Network</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Example 10: Relativitistic Velocity Addition</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Example/Example_10_relativity-addition.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-10-relativitistic-velocity-addition">
<h1>Example 10: Relativitistic Velocity Addition<a class="headerlink" href="#example-10-relativitistic-velocity-addition" title="Link to this heading"></a></h1>
<p>In this example, we will symbolically regress
<span class="math notranslate nohighlight">\(f(u,v)=\frac{u+v}{1+uv}\)</span>. In relavitity, we know the rapidity
trick <span class="math notranslate nohighlight">\(f(u,v)={\rm tanh}({\rm arctanh}\ u+{\rm arctanh}\ v)\)</span>. Can
we rediscover rapidity trick with KAN?</p>
<p>Intialize model and create dataset</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from kan import *

device = torch.device(&#39;cuda&#39; if torch.cuda.is_available() else &#39;cpu&#39;)
print(device)

# initialize KAN with G=3
model = KAN(width=[2,1,1], grid=10, k=3, device=device)

# create dataset
f = lambda x: (x[:,[0]]+x[:,[1]])/(1+x[:,[0]]*x[:,[1]])
dataset = create_dataset(f, n_var=2, ranges=[-0.9,0.9], device=device)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cuda</span>
<span class="n">checkpoint</span> <span class="n">directory</span> <span class="n">created</span><span class="p">:</span> <span class="o">./</span><span class="n">model</span>
<span class="n">saving</span> <span class="n">model</span> <span class="n">version</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>Train KAN and plot</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.fit(dataset, opt=&quot;LBFGS&quot;, steps=20);
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| train_loss: 2.28e-03 | test_loss: 2.31e-03 | reg: 6.50e+00 | : 100%|█| 20/20 [00:03&lt;00:00,  5.88it
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">saving</span> <span class="n">model</span> <span class="n">version</span> <span class="mf">0.1</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.plot(beta=10)
</pre></div>
</div>
<img alt="../_images/Example_10_relativity-addition_6_0.png" src="../_images/Example_10_relativity-addition_6_0.png" />
<p>Retrain the model, the loss remains similar, meaning that the locking
does not degrade model behavior, justifying our hypothesis that these
two activation functions are the same. Let’s now determine what this
function is using <span class="math notranslate nohighlight">\(\texttt{suggest_symbolic}\)</span></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.suggest_symbolic(0,1,0,weight_simple=0.0)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">function</span>  <span class="n">fitting</span> <span class="n">r2</span>    <span class="n">r2</span> <span class="n">loss</span>  <span class="n">complexity</span>  <span class="n">complexity</span> <span class="n">loss</span>  <span class="n">total</span> <span class="n">loss</span>
<span class="mi">0</span>  <span class="n">arctanh</span>    <span class="mf">0.999992</span> <span class="o">-</span><span class="mf">15.786788</span>           <span class="mi">4</span>                <span class="mi">4</span>  <span class="o">-</span><span class="mf">15.786788</span>
<span class="mi">1</span>      <span class="n">tan</span>    <span class="mf">0.999825</span> <span class="o">-</span><span class="mf">12.397871</span>           <span class="mi">3</span>                <span class="mi">3</span>  <span class="o">-</span><span class="mf">12.397871</span>
<span class="mi">2</span>   <span class="n">arccos</span>    <span class="mf">0.998852</span>  <span class="o">-</span><span class="mf">9.753944</span>           <span class="mi">4</span>                <span class="mi">4</span>   <span class="o">-</span><span class="mf">9.753944</span>
<span class="mi">3</span>   <span class="n">arcsin</span>    <span class="mf">0.998852</span>  <span class="o">-</span><span class="mf">9.753944</span>           <span class="mi">4</span>                <span class="mi">4</span>   <span class="o">-</span><span class="mf">9.753944</span>
<span class="mi">4</span>     <span class="n">sqrt</span>    <span class="mf">0.982166</span>  <span class="o">-</span><span class="mf">5.808383</span>           <span class="mi">2</span>                <span class="mi">2</span>   <span class="o">-</span><span class="mf">5.808383</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;arctanh&#39;</span><span class="p">,</span>
 <span class="p">(</span><span class="o">&lt;</span><span class="n">function</span> <span class="n">kan</span><span class="o">.</span><span class="n">utils</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">function</span> <span class="n">kan</span><span class="o">.</span><span class="n">utils</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="mi">4</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">function</span> <span class="n">kan</span><span class="o">.</span><span class="n">utils</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_th</span><span class="p">)</span><span class="o">&gt;</span><span class="p">),</span>
 <span class="mf">0.999992311000824</span><span class="p">,</span>
 <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>We can see that <span class="math notranslate nohighlight">\({\rm arctanh}\)</span> is at the top of the suggestion
list! So we can set both to arctanh, retrain the model, and plot it.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.fix_symbolic(0,0,0,&#39;arctanh&#39;)
model.fix_symbolic(0,1,0,&#39;arctanh&#39;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r2</span> <span class="ow">is</span> <span class="mf">0.9999759197235107</span>
<span class="n">saving</span> <span class="n">model</span> <span class="n">version</span> <span class="mf">0.2</span>
<span class="n">r2</span> <span class="ow">is</span> <span class="mf">0.999992311000824</span>
<span class="n">saving</span> <span class="n">model</span> <span class="n">version</span> <span class="mf">0.3</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span><span class="p">(</span><span class="mf">1.0000</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.fit(dataset, opt=&quot;LBFGS&quot;, steps=20, update_grid=False);
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| train_loss: 7.94e-04 | test_loss: 9.43e-04 | reg: 4.12e+00 | : 100%|█| 20/20 [00:04&lt;00:00,  4.34it
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">saving</span> <span class="n">model</span> <span class="n">version</span> <span class="mf">0.4</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.plot(beta=10)
</pre></div>
</div>
<img alt="../_images/Example_10_relativity-addition_12_0.png" src="../_images/Example_10_relativity-addition_12_0.png" />
<p>We will see that <span class="math notranslate nohighlight">\({\rm tanh}\)</span> is at the top of the suggestion
list! So we can set it to <span class="math notranslate nohighlight">\({\rm tanh}\)</span>, retrain the model to
machine precision, plot it and finally get the symbolic formula.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.suggest_symbolic(1,0,0,weight_simple=0.)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">function</span>  <span class="n">fitting</span> <span class="n">r2</span>    <span class="n">r2</span> <span class="n">loss</span>  <span class="n">complexity</span>  <span class="n">complexity</span> <span class="n">loss</span>  <span class="n">total</span> <span class="n">loss</span>
<span class="mi">0</span>      <span class="n">tanh</span>    <span class="mf">0.999998</span> <span class="o">-</span><span class="mf">16.336284</span>           <span class="mi">3</span>                <span class="mi">3</span>  <span class="o">-</span><span class="mf">16.336284</span>
<span class="mi">1</span>    <span class="n">arctan</span>    <span class="mf">0.999435</span> <span class="o">-</span><span class="mf">10.764618</span>           <span class="mi">4</span>                <span class="mi">4</span>  <span class="o">-</span><span class="mf">10.764618</span>
<span class="mi">2</span>       <span class="n">cos</span>    <span class="mf">0.995899</span>  <span class="o">-</span><span class="mf">7.926177</span>           <span class="mi">2</span>                <span class="mi">2</span>   <span class="o">-</span><span class="mf">7.926177</span>
<span class="mi">3</span>       <span class="n">sin</span>    <span class="mf">0.995899</span>  <span class="o">-</span><span class="mf">7.926177</span>           <span class="mi">2</span>                <span class="mi">2</span>   <span class="o">-</span><span class="mf">7.926177</span>
<span class="mi">4</span>  <span class="n">gaussian</span>    <span class="mf">0.994457</span>  <span class="o">-</span><span class="mf">7.492519</span>           <span class="mi">3</span>                <span class="mi">3</span>   <span class="o">-</span><span class="mf">7.492519</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
 <span class="p">(</span><span class="o">&lt;</span><span class="n">function</span> <span class="n">kan</span><span class="o">.</span><span class="n">utils</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">function</span> <span class="n">kan</span><span class="o">.</span><span class="n">utils</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">function</span> <span class="n">kan</span><span class="o">.</span><span class="n">utils</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_th</span><span class="p">)</span><span class="o">&gt;</span><span class="p">),</span>
 <span class="mf">0.9999979138374329</span><span class="p">,</span>
 <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.fix_symbolic(1,0,0,&#39;tanh&#39;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r2</span> <span class="ow">is</span> <span class="mf">0.9999979138374329</span>
<span class="n">saving</span> <span class="n">model</span> <span class="n">version</span> <span class="mf">0.5</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span><span class="p">(</span><span class="mf">1.0000</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.fit(dataset, opt=&quot;Adam&quot;, lr=1e-3, steps=2000, update_grid=False, singularity_avoiding=True);
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| train_loss: 1.97e-06 | test_loss: 2.06e-06 | reg: 0.00e+00 | : 100%|█| 2000/2000 [00:21&lt;00:00, 93.
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">saving</span> <span class="n">model</span> <span class="n">version</span> <span class="mf">0.6</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.plot()
</pre></div>
</div>
<img alt="../_images/Example_10_relativity-addition_17_0.png" src="../_images/Example_10_relativity-addition_17_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>formula = model.symbolic_formula()[0][0]
nsimplify(ex_round(formula, 4))
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[\displaystyle \tanh{\left(\operatorname{atanh}{\left(x_{1} \right)} + \operatorname{atanh}{\left(x_{2} \right)} \right)}\]</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Example_9_singularity.html" class="btn btn-neutral float-left" title="Example 9: Singularity" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Example_11_encouraing_linear.html" class="btn btn-neutral float-right" title="Example 11: Encouraging linearity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ziming Liu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>